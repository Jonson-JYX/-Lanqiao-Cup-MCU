C51 COMPILER V9.60.7.0   KEYPAD                                                            11/24/2025 15:38:54 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEYPAD
OBJECT MODULE PLACED IN .\Objects\keypad.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE keypad.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ke
                    -ypad.lst) OBJECT(.\Objects\keypad.obj)

line level    source

   1          #include <stc15f2k60s2.h>
   2          #include "keypad.h"
   3          #include "delay.h"
   4          #include "common.h"
   5          
   6          //按键事件类型定义
   7          //无按键按下
   8          #define Key_None 0;
   9          //按键短按
  10          #define Key_Short_Pressed 1;
  11          //按键长按
  12          #define Key_Long_Pressed 2;
  13          
  14          //按键短按键值表
  15          code unsigned char Key_Num[9] = {
  16                  0,1,2,3,4,5,6,7,8
  17          };
  18          
  19          //检测按键是否按下函数
  20          bit isKeyPressed (unsigned char row,unsigned char col){
  21   1              unsigned int PressTime = 0; //按键初始化按下时间为0
  22   1              
  23   1              //设置行
  24   1              P3 = (P3 & 0xF0) | 0x0F;        //将行线全部置高
  25   1              switch(row){
  26   2                      case 1:P30 = 0;break;
  27   2                      case 2:P31 = 0;break;
  28   2                      case 3:P32 = 0;break;
  29   2                      case 4:P33 = 0;break;
  30   2              }
  31   1              //消抖
  32   1              Delay100us();
  33   1              //设置列
  34   1              if((col == 0 && P44 == 0) || (col == 1 && P42 == 0)){
  35   2                      
  36   2                      //持续检测按键的状态
  37   2                      while((col == 0 && P44 == 0) || (col == 1 && P42 == 0)){
  38   3                              Delay10ms();    //10毫秒为一个计时单位
  39   3                              PressTime++;
  40   3                              
  41   3                              //超过1秒则判定为长按
  42   3                              if(PressTime > 100){
  43   4                                      //等待按键释放
  44   4                                      while((col == 0 && P44 == 0) || (col == 1 && P42 == 0));
  45   4                                      return Key_Long_Pressed;
  46   4                              }
  47   3                              
  48   3                      }
  49   2                      //否则判定为短按
  50   2                      return Key_Short_Pressed;
  51   2              }
  52   1              //若都没有返回则返回无按键按下
  53   1              return Key_None;
  54   1      }
C51 COMPILER V9.60.7.0   KEYPAD                                                            11/24/2025 15:38:54 PAGE 2   

  55          
  56          //按键扫描函数
  57          unsigned char Key_Scan(){
  58   1              unsigned char Key = 0xFF;       //默认无按键按下
  59   1              unsigned char row = 0;          //记录按键按下的行
  60   1              unsigned char col = 0;          //记录按键按下的列
  61   1              //检测是否有按键按下
  62   1              for(row = 0;row < 4;row++){
  63   2                      for(col = 0;col < 2;col++){
  64   3                              if(isKeyPressed(row,col)){      //获取对应键值
  65   4                                      if(row == 0 && col == 0){
  66   5                                              Key = Key_Num[3];
  67   5                                      }
  68   4                                      if(row == 1 && col == 0){
  69   5                                              Key = Key_Num[2];
  70   5                                      }
  71   4                                      if(row == 2 && col == 0){
  72   5                                              Key = Key_Num[1];
  73   5                                      }
  74   4                                      if(row == 3 && col == 0){
  75   5                                              Key = Key_Num[0];
  76   5                                      }
  77   4                                      if(row == 0 && col == 1){
  78   5                                              Key = Key_Num[8];
  79   5                                      }
  80   4                                      if(row == 1 && col == 1){
  81   5                                              Key = Key_Num[7];
  82   5                                      }
  83   4                                      if(row == 2 && col == 1){
  84   5                                              Key = Key_Num[6];
  85   5                                      }
  86   4                                      if(row == 3 && col == 1){
  87   5                                              Key = Key_Num[5];
  88   5                                      }
  89   4                                      if(row == 4 && col == 1){
  90   5                                              Key = Key_Num[4];
  91   5                                      }
  92   4                              }
  93   3                      }
  94   2              }
  95   1              return Key_Num[9];
  96   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    319    ----
   CONSTANT SIZE    =      9    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
