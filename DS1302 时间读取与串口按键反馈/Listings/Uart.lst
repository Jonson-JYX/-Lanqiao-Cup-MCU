C51 COMPILER V9.60.7.0   UART                                                              01/21/2026 15:12:44 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\Uart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Uart.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Uart
                    -.lst) OBJECT(.\Objects\Uart.obj)

line level    source

   1          #include <stc15f2k60s2.h>
   2          #include "Uart.h"
   3          #include "DS1302.h"
   4          #include "KEY.h"
   5          
   6          #define BAUD         9600  //波特率
   7          #define SYSTEMCLOCK  12000000L  //系统时钟频率
   8          
   9          unsigned char time_send_Hour[8] = {0};
  10          unsigned char time_send_Minute[10] = {0};
  11          unsigned char time_send_Second[10] = {0};
  12          
  13          void Uart_Init(void)    //9600bps@12.000MHz
  14          {
  15   1              SCON = 0x50;            //8位数据,可变波特率
  16   1              AUXR |= 0x40;           //定时器时钟1T模式
  17   1              AUXR &= 0xFE;           //串口1选择定时器1为波特率发生器
  18   1              TMOD &= 0x0F;           //设置定时器模式
  19   1              TL1 = 0xC7;                     //设置定时初始值
  20   1              TH1 = 0xFE;                     //设置定时初始值
  21   1              ET1 = 0;                        //禁止定时器中断
  22   1              TR1 = 1;                        //定时器1开始计时
  23   1      }
  24          
  25          //通过串口发送字符串
  26          void uart_sendstring(unsigned char *str)
  27          {
  28   1          unsigned char *p;
  29   1          p = str;
  30   1          while(*p != '\0')
  31   1          {
  32   2              SBUF = *p;
  33   2              while(TI == 0);  //等待发送标志位置位
  34   2              TI = 0;
  35   2              p++;
  36   2          }
  37   1      }
  38          
  39          //接收时间转化函数
  40          void Change_Time(){
  41   1              unsigned char *p_rtc = ReadRTC();
  42   1              
  43   1              // 时
  44   1              time_send_Hour[0] = 'H';
  45   1          time_send_Hour[1] = 'o';
  46   1          time_send_Hour[2] = 'u';
  47   1          time_send_Hour[3] = 'r';
  48   1          time_send_Hour[4] = ':';
  49   1          time_send_Hour[5] = p_rtc[0] + '0'; // 小时十位
  50   1          time_send_Hour[6] = p_rtc[1] + '0';      // 小时个位
  51   1          time_send_Hour[7] = '\0';
  52   1          // 钟
  53   1              time_send_Minute[0] = 'M';
  54   1              time_send_Minute[1] = 'i';
C51 COMPILER V9.60.7.0   UART                                                              01/21/2026 15:12:44 PAGE 2   

  55   1              time_send_Minute[2] = 'n';
  56   1              time_send_Minute[3] = 'u';
  57   1              time_send_Minute[4] = 't';
  58   1              time_send_Minute[5] = 'e';
  59   1              time_send_Minute[6] = ':';
  60   1          time_send_Minute[7] = p_rtc[3] + '0'; // 分钟十位
  61   1          time_send_Minute[8] = p_rtc[4] + '0';      // 分钟个位
  62   1          time_send_Minute[9] = '\0';
  63   1          // 秒
  64   1              time_send_Second[0] = 'S';
  65   1              time_send_Second[1] = 'e';
  66   1              time_send_Second[2] = 'c';
  67   1              time_send_Second[3] = 'o';
  68   1              time_send_Second[4] = 'n';
  69   1              time_send_Second[5] = 'd';
  70   1              time_send_Second[6] = ':';
  71   1          time_send_Second[7] = p_rtc[6] + '0'; // 秒十位
  72   1          time_send_Second[8] = p_rtc[7] + '0';      // 秒个位
  73   1              time_send_Second[9] = '\0';
  74   1      }
  75          
  76          void Send_Time(){
  77   1              unsigned char key = Key_Scan();
  78   1              Change_Time();
  79   1              if(key == 1){
  80   2                      uart_sendstring(time_send_Hour);
  81   2              }
  82   1              if(key == 2){
  83   2                      uart_sendstring(time_send_Minute);
  84   2              }
  85   1              if(key == 3){
  86   2                      uart_sendstring(time_send_Second);
  87   2              }
  88   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    223    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     28       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
