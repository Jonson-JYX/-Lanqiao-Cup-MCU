C51 COMPILER V9.60.7.0   KEY                                                               01/23/2026 15:16:50 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\KEY.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE KEY.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\KEY.l
                    -st) OBJECT(.\Objects\KEY.obj)

line level    source

   1          #include <stc15f2k60s2.h>
   2          #include "Delay.h"
   3          
   4          //界面模式锁
   5          bit KEY_Password = 0;
   6          //S4按键模式计数器（初始化为1，确保默认时间界面）
   7          unsigned char S4_Cnt = 1;
   8          unsigned char S4 = 1;  // 初始化默认模式为1（时间界面）
   9          unsigned char S5;
  10          
  11          //按键键值存储表
  12          code unsigned char KEY_Value[12] = {
  13              0,1,2,3,4,5,6,7,8,9,10,11
  14          };
  15          
  16          //按键扫描函数
  17          unsigned char KEY_Scan(){
  18   1          // 新增：默认返回无按键（0xFF），避免返回随机值
  19   1          unsigned char key = 0xFF;
  20   1          //第二行扫描
  21   1          P31 = 0;P32 = 1;P33 = 1;
  22   1          if(P44 == 0){
  23   2              Delay10ms();
  24   2              while(P44 == 0); // 等待按键释放，避免重复触发
  25   2              key = KEY_Value[0];
  26   2          }else if(P42 == 0){
  27   2              Delay10ms();
  28   2              while(P42 == 0);
  29   2              key = KEY_Value[1];
  30   2          }else if(P35 == 0){
  31   2              Delay10ms();
  32   2              while(P35 == 0);
  33   2              key = KEY_Value[2];
  34   2          }else if(P34 == 0){
  35   2              Delay10ms();
  36   2              while(P34 == 0);
  37   2              key = KEY_Value[3];
  38   2          }
  39   1          //第三行扫描
  40   1          P31 = 1;P32 = 0;P33 = 1;
  41   1          if(P44 == 0){
  42   2              Delay10ms();
  43   2              while(P44 == 0);
  44   2              key = KEY_Value[10];
  45   2          }else if(P42 == 0){
  46   2              Delay10ms();
  47   2              while(P42 == 0);
  48   2              key = KEY_Value[4];
  49   2          }else if(P35 == 0){
  50   2              Delay10ms();
  51   2              while(P35 == 0);
  52   2              key = KEY_Value[5];
  53   2          }else if(P34 == 0){
  54   2              Delay10ms();
C51 COMPILER V9.60.7.0   KEY                                                               01/23/2026 15:16:50 PAGE 2   

  55   2              while(P34 == 0);
  56   2              key = KEY_Value[6];
  57   2          }
  58   1          //第四行扫描
  59   1          P31 = 1;P32 = 1;P33 = 0;
  60   1          if(P44 == 0){
  61   2              Delay10ms();
  62   2              while(P44 == 0);
  63   2              key = KEY_Value[11];
  64   2          }else if(P42 == 0){
  65   2              Delay10ms();
  66   2              while(P42 == 0);
  67   2              key = KEY_Value[7];
  68   2          }else if(P35 == 0){
  69   2              Delay10ms();
  70   2              while(P35 == 0);
  71   2              key = KEY_Value[8];
  72   2          }else if(P34 == 0){
  73   2              Delay10ms();
  74   2              while(P34 == 0);
  75   2              key = KEY_Value[9];
  76   2          }
  77   1          return key;
  78   1      }
  79          
  80          //按键S4函数
  81          unsigned char KEY_S4(){
  82   1          if(S4_Cnt > 3){
  83   2              S4_Cnt = 1;
  84   2          }
  85   1          // 返回当前界面模式
  86   1          return S4_Cnt;
  87   1      }
  88          
  89          //按键S5函数
  90          unsigned char KEY_S5(){
  91   1          return 4;
  92   1      }
  93          
  94          //按键综合函数
  95          unsigned char KEY_ALL(){
  96   1          unsigned char num = KEY_Scan();
  97   1          if(num == 11){ // S4按键（切换界面）
  98   2              S4_Cnt++;
  99   2              S4 = KEY_S4();
 100   2              if(S4 == 2){
 101   3                  KEY_Password = 1; // 输入界面解锁
 102   3              }else{
 103   3                  KEY_Password = 0; // 其他界面锁定输入
 104   3              }
 105   2              return S4;
 106   2          }else if(num == 10){ // S5按键（清除输入）
 107   2              S5 = KEY_S5();
 108   2              return S5;
 109   2          }
 110   1          // 无按键时返回当前默认模式（确保初始界面为时间界面）
 111   1          return S4;
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    255    ----
C51 COMPILER V9.60.7.0   KEY                                                               01/23/2026 15:16:50 PAGE 3   

   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
