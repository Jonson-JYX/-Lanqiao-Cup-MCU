#include <stc15f2k60s2.h>
#include "displays.h"
#include "common.h"

//共阳数码管段码表
code unsigned char Seg_Table[17][8] = {
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xC0,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xA4,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xB0,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x99,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x92,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x82,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF8,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x90,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,0xC0,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,0xF9,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,0xA4,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,0xB0,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,0x99,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,0x92,
	0xC8,0xFF,0xFF,0xFF,0xFF,0xFF,0xF9,0x82
};

//数码管显示函数
void Seg_Display(unsigned char number){
	unsigned char com = 0;		//位选移动变量
	unsigned char i;			//数码管循环显示变量
	unsigned char num = number;	//定义获取第几组数据(需要传参)
	unsigned char dat;			//定义存储数据的缓冲区
	//消影
	SEG(0xFF);
	//循环显示八位效果
	for(i = 0 ;i < 8 ;i++){
		//消影
		SEG(0xFF);
		//位选移动一位
		COM(1<<com);
		//将对应数据放入缓冲区
		dat = Seg_Table[num][i];
		//显示对应数码管的数据调用宏定义（common.h）
		SEG(dat);
		//位选加一
		com++;
	}
	//循环后位选归零
	com = 0;
	//关闭所有位选
	COM(0x00);
}