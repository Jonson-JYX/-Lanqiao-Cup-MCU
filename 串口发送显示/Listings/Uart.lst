C51 COMPILER V9.60.7.0   UART                                                              02/02/2026 12:53:02 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\Uart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Uart.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Uart
                    -.lst) OBJECT(.\Objects\Uart.obj)

line level    source

   1          #include <stc15f2k60s2.h>
   2          
   3          unsigned char rx_buf[1] = {0};    
   4          unsigned char rx_cnt = 0;         // 接收字符计数
   5          bit rx_complete_flag = 0;         // 接收完成标志
   6          
   7          void Uart1_Init(void)   //9600bps@12.000MHz
   8          {
   9   1              SCON = 0x50;            //8位数据,可变波特率
  10   1              AUXR |= 0x40;           //定时器时钟1T模式
  11   1              AUXR &= 0xFE;           //串口1选择定时器1为波特率发生器
  12   1              TMOD &= 0x0F;           //设置定时器模式
  13   1              TL1 = 0xC7;                     //设置定时初始值
  14   1              TH1 = 0xFE;                     //设置定时初始值
  15   1              ET1 = 0;                        //禁止定时器中断
  16   1              TR1 = 1;                        //定时器1开始计时
  17   1              ES = 1;                         //使能串口1中断
  18   1              EA = 1;
  19   1      }
  20          
  21          void Uart_Isr(void) interrupt 4
  22          {
  23   1              if (TI)                         //检测串口1发送中断
  24   1              {
  25   2                      TI = 0;                 //清除串口1发送中断请求位
  26   2              }
  27   1              if (RI)                         //检测串口1接收中断
  28   1              {
  29   2                       RI = 0;  // 清接收中断标志
  30   2              if(rx_cnt < 1)  // 只接收1个字符
  31   2              {
  32   3                  rx_buf[rx_cnt] = SBUF;  // 存储接收字符
  33   3                  rx_cnt++;               // 计数+1
  34   3                  if(rx_cnt == 1)         // 1个字符接收完成 
  35   3                  {
  36   4                      rx_complete_flag = 1;    // 置接收完成标志
  37   4                  }
  38   3              }
  39   2              else
  40   2              {
  41   3                  // 超出1个字符，重置缓冲区
  42   3                  rx_cnt = 0;
  43   3                  rx_buf[0] = 0;  
  44   3              }
  45   2              }
  46   1      }
  47          
  48          unsigned char *Arr_Value(){
  49   1              if(rx_complete_flag)
  50   1          {
  51   2              return rx_buf;  // 接收完成返回缓冲区地址
  52   2          }
  53   1      }
*** WARNING C291 IN LINE 53 OF Uart.c: not every exit path returns a value
C51 COMPILER V9.60.7.0   UART                                                              02/02/2026 12:53:02 PAGE 2   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     94    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
