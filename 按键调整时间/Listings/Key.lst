C51 COMPILER V9.60.7.0   KEY                                                               01/18/2026 12:32:50 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\Key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Key.l
                    -st) OBJECT(.\Objects\Key.obj)

line level    source

   1          #include <stc15f2k60s2.h>
   2          #include "Key.h"
   3          #include "Delay.h"
   4          #include "DS1302.h"
   5          
   6          sbit S7  = P3 ^ 0;
   7          sbit S6  = P3 ^ 1;
   8          sbit S5  = P3 ^ 2;
   9          
  10          //定义键值数组
  11          code unsigned char Key_Value[3] = {1,2,3};
  12          
  13          //按键扫描函数
  14          unsigned char Key_Scan(){
  15   1              if(S7 == 0){
  16   2                      Delay500ms();
  17   2                      Delay500ms();
  18   2                      Delay500ms();
  19   2                      while(S7 == 0){
  20   3                              return Key_Value[2];
  21   3                      }
  22   2              }
  23   1              
  24   1              if(S6 == 0){
  25   2                      Delay500ms();
  26   2                      Delay500ms();
  27   2                      Delay500ms();
  28   2                      while(S6 == 0){
  29   3                              return Key_Value[1];
  30   3                      }
  31   2              }       
  32   1              
  33   1              if(S5 == 0){
  34   2                      Delay500ms();
  35   2                      Delay500ms();
  36   2                      Delay500ms();
  37   2                      while(S5 == 0){
  38   3                              return Key_Value[0];
  39   3                      }
  40   2              }
  41   1              return 0;
  42   1      }
  43          
  44          //按键工作函数
  45          void Key_Change(unsigned char *dat){
  46   1              unsigned char hour;
  47   1              unsigned char minute;
  48   1              unsigned char key;        //获取按键键值
  49   1              
  50   1              key = Key_Scan();
  51   1              if(key == 1){ // S5：时加1
  52   2                      // 组合十位+个位为完整的“时”值
  53   2                      hour = dat[0] * 10 + dat[1];
  54   2                      hour++;
C51 COMPILER V9.60.7.0   KEY                                                               01/18/2026 12:32:50 PAGE 2   

  55   2                      if(hour >= 24){ // 时满24清零
  56   3                              hour = 0;
  57   3                      }
  58   2                      // 拆分回十位和个位
  59   2                      dat[0] = hour / 10;
  60   2                      dat[1] = hour % 10;
  61   2                      // 同步到DS1302
  62   2                      SyncRTCToDS1302(dat);
  63   2              }
  64   1              if(key == 2){ // S6：分加1
  65   2                      // 组合十位+个位为完整的“分”值
  66   2                      minute = dat[3] * 10 + dat[4];
  67   2                      minute++;
  68   2                      if(minute >= 60){ // 分满60清零，时进位
  69   3                              minute = 0;
  70   3                              // 时进位处理
  71   3                              hour = dat[0] * 10 + dat[1];
  72   3                              hour++;
  73   3                              if(hour >= 24){
  74   4                                      hour = 0;
  75   4                              }
  76   3                              dat[0] = hour / 10;
  77   3                              dat[1] = hour % 10;
  78   3                      }
  79   2                      // 拆分分的十位和个位
  80   2                      dat[3] = minute / 10;
  81   2                      dat[4] = minute % 10;
  82   2                      // 同步到DS1302
  83   2                      SyncRTCToDS1302(dat);
  84   2              }
  85   1              if(key == 3){ // S7：秒清零
  86   2                      dat[6] = 0;
  87   2                      dat[7] = 0;
  88   2                      // 同步到DS1302
  89   2                      SyncRTCToDS1302(dat);
  90   2              }
  91   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    324    ----
   CONSTANT SIZE    =      3    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
